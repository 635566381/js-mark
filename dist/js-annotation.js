var e;function t(n){for(var o=[],r=n.childNodes,a=0;a<r.length;a++){var i=r[a];i.nodeType!==e.TEXT_NODE?o.push.apply(o,t(i)):o.push(i)}return o}function n(e,n){for(var o=t(n),r=o.indexOf(e),a=0,i=0;i<r;i++)o[i]&&null!==o[i].nodeValue&&(a+=o[i].nodeValue.length);return a}function o(e,n){for(var o=null,r=0,a=t(e),i=0;i<a.length;i++)if(a[i]&&null!==a[i].nodeValue&&(r+=a[i].nodeValue.length),n<=r){o=a[i];break}return o}!function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE"}(e||(e={}));var r=function(){function e(e){this.element=e,this.selection=window.getSelection(),this._mouseUp=null,this._click=null,this._selected=null,this.onSelected=null,this.onClick=null,this._initEvent()}return e.prototype._initEvent=function(){var e=this;this._mouseUp=function(t){e.captureSelection(void 0,t)},this._click=function(t){if(null!==t.target&&"dataset"in t.target){var n=t.target.dataset.selector;if(n){var o=document.querySelectorAll('span[data-selector="'+n+'"]');e.onClick&&e.onClick(o)}}},this._selected=function(e){this.onSelected&&this.onSelected({code:"string"==typeof e?-1:1,data:e})},this.addEvent()},e.prototype.addEvent=function(){var e=this;this.element.addEventListener("mouseup",(function(t){e._mouseUp&&e._mouseUp(t)}))},e.prototype.destroyEvent=function(){var e=this;this.element.removeEventListener("mouseup",(function(t){e._mouseUp&&e._mouseUp(t)}))},e.prototype.fromStore=function(e){var t=this;e.map((function(e){var r=o(t.element,e.offset),a=o(t.element,e.offset+e.text.length);a&&r&&t.captureSelection({collapsed:!1,commonAncestorContainer:t.element,endContainer:a,endOffset:e.offset+e.text.length-n(a,t.element),startContainer:r,startOffset:e.offset-n(r,t.element),other:e})}))},e.prototype.captureSelection=function(e,o){var r=this.selection;if(null!=r){var a=e||r.getRangeAt(0);if(a.collapsed)this._click&&this._click(o);else{var i={startContainer:a.startContainer,endContainer:a.endContainer,startOffset:a.startOffset,endOffset:a.endOffset};if(i.startContainer.parentNode.dataset.selector||i.endContainer.parentNode.dataset.selector)return r.removeAllRanges(),this._selected&&this._selected("\u4e0d\u5141\u8bb8\u91cd\u590d\u6807\u6ce8");var l=i.endContainer.splitText(i.endOffset);i.startContainer=i.startContainer.splitText(i.startOffset),i.endContainer=l.previousSibling;for(var s=t(a.commonAncestorContainer),c=n(i.startContainer,this.element),d=this.getSelectTextNode(s,i),f="",u=0;u<d.length;u++){f+=d[u].nodeValue}var p=!0;e||(p=!1,r.removeAllRanges()),this._selected&&this._selected({nodes:d,other:e&&e.other?e.other:{},text:f,offset:c,firstRender:p})}}},e.prototype.getSelectTextNode=function(e,t){var n=e.indexOf(t.startContainer),o=e.indexOf(t.endContainer);return e.filter((function(e,t){return n<=t&&o>=t}))},e.prototype.repaintRange=function(e,t,n){var o=t||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}));return e.forEach((function(e){if(e.parentNode){var t=document.createElement("span");t.className=n,t.setAttribute("data-selector",o),e.parentNode.replaceChild(t,e),t.appendChild(e)}})),t},e.prototype.clearRange=function(e){document.querySelectorAll('span[data-selector="'+e+'"]').forEach((function(e){if(e.parentNode){for(var t=document.createDocumentFragment(),n=e.childNodes,o=0;o<n.length;o++){var r=n[o];t.appendChild(r.cloneNode(!0))}e.parentNode.replaceChild(t,e)}}))},e}();export default r;
