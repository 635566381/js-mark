<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .annotator-hl {
            cursor: pointer;
            background: rgba(255, 255, 0, 0.3);
        }

        .annotator-h1 {
            cursor: pointer;
            background: rgba(0, 0, 255, 0.3);
        }

        .annotator-h2 {
            cursor: pointer;
            background: rgba(0, 255, 127, 0.3);
        }

        .annotator-h3 {
            cursor: pointer;
            background: rgba(255, 0, 0, 0.3);
        }
    </style>
</head>

<body>
    <div id="highlight">内容：   蚂蚁基金真是好健康的零食交罚款阿迪极乐世界啊发来的就是反馈三大纪律放假啊谁来的快</div>
    <!-- <script src="../build/js-mark.js"></script> -->
    <script type="module">
        //  import textSelector from "../dist/js-mark.js";
        import textSelector from "../build/index.js";
        window.onload = function () {
            function setLocal(position) {
                let data = getLocal();
                data.push(position);
                localStorage.setItem("data", JSON.stringify(data));
            }
            function getLocal() {
                return JSON.parse(localStorage.getItem("data")) || [];
            }
            function clearItemLocal(id) {
                let data = getLocal();
                data = data.filter((item) => item.uuid !== id);
                localStorage.setItem("data", JSON.stringify(data));
            }
            let cssIndex = 0;
            let cssStyle = [
                "annotator-hl",
                "annotator-h1",
                "annotator-h2",
                "annotator-h3",
            ];

            let textDom = document.querySelector("#highlight");
            let lineHeight = new textSelector({
                el:textDom,
                options:{
                    isCover:true
                }
            });
            //选中文本后回调
            lineHeight.onSelected = function (res) {
                if (res.code === 1) {
                    let data = res.data;
                    let uid = data.other.uuid;
                    let uuid = lineHeight.repaintRange(data.nodes,uid, cssStyle[cssIndex]);
                    ++cssIndex >= cssStyle.length ? (cssIndex = 0) : cssIndex;
                    if (!data.firstRender) {
                        setLocal({
                            offset: data.offset,
                            text: data.text,
                            uuid,
                        });
                    }
                } else {
                    console.log(res.data);
                }
            };
            //点击高亮节点后显示
            lineHeight.onClick = function (eleArr) {
                alert("删除")
                lineHeight.clearRange("1");
                clearItemLocal(eleArr[0].dataset.selector);
            };
            //本地数据渲染
            lineHeight.renderStore(getLocal());
        }
    </script>
</body>


</html>