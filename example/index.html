<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .annotator-hl {
            cursor: pointer;
            background: rgba(255, 255, 0, 0.3);
        }

        .annotator-h1 {
            cursor: pointer;
            background: rgba(0, 0, 255, 0.3);
        }

        .annotator-h2 {
            cursor: pointer;
            background: rgba(0, 255, 127, 0.3);
        }

        .annotator-h3 {
            cursor: pointer;
            background: rgba(255, 0, 0, 0.3);
        }

        .content {
            padding: 20px 20%;
        }

        .ignore,.ignore1{
            user-select: none;
            background: rgb(245, 245, 245);
        }
        
    
        
    </style>
</head>

<body>
    <div id="highlight" class="content">
        <sr-read style='font-family: "Microsoft Yahei"; margin: 20px 17%;'>
            <h1 class="ceshi" style="text-align: center;font-size: 40px;"> Baleen whales eat — and poop — a lot more than we thought
            </h1>


            <sr-rd-content>
                <div id="readability-page-1" class="page">
                    <div role="presentation">
                        <div>
                            <div data-qa-selector="article_text" elementtiming="article-text">
                                <div>
                                    <div style="display: inline-block;width:20px">34      </div>
                                    <p data-paragraph-index="0">Whale 
                                       <span class="ignore hahah">hunting has plundered the seas</span>  of giant whales for
                                        much of the last century. With the help of modern technology, people have killed
                                        up to 99 percent of certain species. Some scientists thought this would cause
                                        krill — the tiny crustaceans that many whales gulp down — to explode in number.
                                        But that didn't happen. New research suggests whale poop, or a lack of it, may
                                        explain this.</p>
                                    <p data-paragraph-index="1">Krill numbers in Antarctic waters with lots of whale
                                        hunting have dropped by more than 80 percent. With fewer of these crustaceans,
                                        many other krill predators have gone hungry, such as seabirds and fish.</p>
                                    <div>
                                        <img src="./demo1.jpg" alt="2" style="width:100%">
                                    </div>
                                    <p data-paragraph-index="2" class="ignore">A new study looked at the eating habits of baleen whales
                                        (those that use long keratin plates of baleen to help snag prey). These include
                                        blue and humpback whales. Apparently, baleen whales eat about three times as
                                        much food as we thought. Lots more food means lots more poop. That poop is rich
                                        in iron. So with fewer whales, ecosystems get less iron and other crucial
                                        nutrients that they need to thrive. That hurts other species, including krill.
                                    </p>
                                    <p data-paragraph-index="3">The team shared its findings in the November 4 issue of
                                        Nature. Restoring whale populations, the researchers say, could help these
                                        ecosystems recover.</p>
                                   
                            </div>
                        </div>
                    </div>
                </div>
            </sr-rd-content>

        </sr-read>
    </div>
    <script src="../dist/js-mark.js"></script>
    <script type="module">
        function setLocal(position) {
            let data = getLocal();
            data.push(position);
            localStorage.setItem("data", JSON.stringify(data));
        }
        function getLocal() {
            return JSON.parse(localStorage.getItem("data")) || [];
        }
        function clearItemLocal(id) {
            let data = getLocal();
            data = data.filter((item) => item.uuid !== id);
            localStorage.setItem("data", JSON.stringify(data));
        }
        window.onload = function () {
            let cssIndex = 0;
            let cssStyle = [
                "annotator-hl",
                "annotator-h1",
                "annotator-h2",
                "annotator-h3",
            ];

            let jsMark = new JsMark({
                el: document.querySelector("#highlight"),
                options:{
                    isCover:false,
                    ignoreClass:["ignore1","ignore"]
                }
            });
            //选中文本后回调
            jsMark.onSelected = function (res) {
                let uuid = jsMark.repaintRange({
                    textNodes: res.textNodes,
                    className: cssStyle[cssIndex]
                });
                    // const ele = document.createElement("span")
                    // ele.textContent="[4444]"
                    // ele.classList="ignore"
                    // res.textNodes[res.textNodes.length-1].parentNode.append(ele)

                ++cssIndex >= cssStyle.length ? (cssIndex = 0) : cssIndex;
            
                if (!res.hasStoreRender) {
                    setLocal({
                        offset: res.offset,
                        text: res.text,
                        uuid,
                    });
                }
            };
            //点击高亮节点后显示
            jsMark.onClick = function (uid) {
                let hasDelete = confirm("是否删除");
                if (hasDelete) {
                    jsMark.deleteMark(uid);
                    clearItemLocal(uid);
                }
            };
            //本地数据渲染
            // jsMark.renderStore(jsMark.findWord("1"));
            jsMark.renderStore(getLocal());
            
        }
    </script>
</body>


</html>